{% extends "base.html" %}

{% block title %}Carmen Admin Login{% endblock %}

{% block head %}
<style>
    .login-card {
        background: white;
        width: 100%;
        max-width: 400px;
        padding: 40px;
        border-radius: 24px;
        box-shadow: 0 25px 50px -12px rgba(52, 85, 139, 0.15);
        text-align: center;
        margin: 100px auto;
        animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .logo-wrapper {
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #34558b 0%, #2a4370 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px auto;
        box-shadow: 0 10px 20px rgba(52, 85, 139, 0.3);
    }

    .logo-wrapper svg {
        width: 32px;
        height: 32px;
        fill: white;
    }

    h2 {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #1e293b;
    }

    p.subtitle {
        color: #64748b;
        font-size: 14px;
        margin-bottom: 32px;
    }

    .input-group {
        margin-bottom: 20px;
        text-align: left;
    }

    label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #1e293b;
    }

    input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        font-size: 15px;
        transition: all 0.2s;
        font-family: inherit;
    }

    input:focus {
        border-color: #34558b;
        box-shadow: 0 0 0 3px rgba(52, 85, 139, 0.1);
    }

    .btn-login {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #34558b 0%, #2a4370 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-top: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(52, 85, 139, 0.2);
    }

    .spinner {
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
        display: none;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .error-msg {
        color: #ef4444;
        font-size: 13px;
        margin-top: 15px;
        display: none;
    }

    .back-link {
        display: block;
        margin-top: 20px;
        font-size: 13px;
        color: #64748b;
        text-decoration: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="login-card">
    <div class="logo-wrapper">
        <svg viewBox="0 0 24 24">
            <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
        </svg>
    </div>

    <h2>Carmen Dashboard</h2>
    <p class="subtitle">กรุณาเข้าสู่ระบบเพื่อจัดการข้อมูล</p>

    <form id="loginForm">
        <div class="input-group">
            <label for="username">Username</label>
            <input type="text" id="username" placeholder="เช่น admin" required>
        </div>

        <div class="input-group">
            <label for="password">Password</label>
            <input type="password" id="password" placeholder="••••••••" required>
        </div>

        <button type="submit" class="btn-login" id="loginBtn">
            <div class="spinner" id="btnSpinner"></div>
            <span id="btnText">เข้าสู่ระบบ</span>
        </button>
        <p class="error-msg" id="errorMsg">ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง</p>
    </form>

    <a href="/" class="back-link">← กลับไปหน้าหลัก</a>
</div>
{% endblock %}

{% block scripts %}
<script>
    const API_BASE_URL = window.location.origin;

    document.getElementById('loginForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const errorMsg = document.getElementById('errorMsg');
        const loginBtn = document.getElementById('loginBtn');
        const btnText = document.getElementById('btnText');
        const btnSpinner = document.getElementById('btnSpinner');

        errorMsg.style.display = 'none';
        loginBtn.disabled = true;
        btnText.textContent = "กำลังตรวจสอบ...";
        btnSpinner.style.display = "block";

        try {
            const response = await fetch(`${API_BASE_URL}/api/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username: document.getElementById('username').value,
                    password: document.getElementById('password').value
                })
            });

            const data = await response.json();
            if (response.ok) {
                localStorage.setItem('carmen_user_session', JSON.stringify(data));
                window.location.href = data.role === 'admin' ? '/dashboard.html' : '/';
            } else {
                throw new Error(data.detail || 'การเข้าสู่ระบบล้มเหลว');
            }
        } catch (error) {
            errorMsg.textContent = "❌ " + error.message;
            errorMsg.style.display = 'block';
        } finally {
            loginBtn.disabled = false;
            btnText.textContent = "เข้าสู่ระบบ";
            btnSpinner.style.display = "none";
        }
    });
</script>
{% endblock %}